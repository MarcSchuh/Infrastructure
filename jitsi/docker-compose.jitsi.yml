services:
  # Prosody (XMPP server)
  prosody:
    image: jitsi/prosody:${JITSI_VERSION}
    container_name: jitsi_prosody
    restart: ${RESTART_POLICY}
    ports:
      - "5222:5222"
      - "5347:5347"
      - "5280:5280"
    volumes:
      - ${CONFIG_DIR}/prosody:/config:Z
    env_file:
      - .env
    networks:
      - jitsi_network

  # Jicofo (Focus component)
  jicofo:
    image: jitsi/jicofo:stable
    container_name: jitsi_jicofo
    restart: unless-stopped
    depends_on:
      - prosody
    volumes:
      - ${CONFIG_DIR}/jicofo:/config:Z
    env_file:
      - .env
    networks:
      - jitsi_network

  # JVB (Video Bridge)
  jvb:
    image: jitsi/jvb:${JITSI_VERSION}
    container_name: jitsi_jvb
    restart: ${RESTART_POLICY}
    depends_on:
      - prosody
    ports:
      - "10000:10000/udp"
    volumes:
      - ${CONFIG_DIR}/jvb:/config:Z
    env_file:
      - .env
    networks:
      - jitsi_network

  # Web (Jitsi Meet web interface)
  web:
    image: jitsi/web:${JITSI_VERSION}
    container_name: jitsi_web
    restart: ${RESTART_POLICY}
    depends_on:
      - prosody
      - jicofo
      - jvb
    volumes:
      - ${CONFIG_DIR}/web:/config:Z
      - ${CONFIG_DIR}/transcripts:/usr/share/jitsi-meet/transcripts:Z
    env_file:
      - .env
    networks:
      - jitsi_network
    ports:
      - "${HTTP_PORT}:80"
      - "${HTTPS_PORT}:443"

networks:
  jitsi_network:
    external: true

