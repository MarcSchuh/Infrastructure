user  nginx;
worker_processes  auto;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    multi_accept on;
    use epoll;
}

http {
    # Basic recommended settings
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # Performance settings
    sendfile        on;
    tcp_nopush      on;
    tcp_nodelay     on;
    keepalive_timeout  65;
    types_hash_max_size 2048;
    
    # Security settings
    server_tokens off;
    
    # Logging settings
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log warn;
    
    # Gzip settings
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml;
    
    # Include security headers and common settings
    include /etc/nginx/security-headers.conf;
    
    # Default server block - returns 444 (connection closed) instead of 404
    server {
        listen 80 default_server;
        listen [::]:80 default_server;
        return 444;
    }

    # Default SSL server block
    server {
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;

    #TODO: Replace by snakeoil certificate
    ssl_certificate /etc/letsencrypt/live/jitsi.test.mydomain.de/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/jitsi.test.mydomain.de/privkey.pem;

    return 444;
    }
  #include /etc/nginx/services-config/jitsi.conf;
  #include /etc/nginx/services-config/wordpress.conf;
  #include /etc/nginx/services-config/nextcloud.conf;
  #include /etc/nginx/services-config/grafana.conf;
  #include /etc/nginx/services-config/status.conf;


}

